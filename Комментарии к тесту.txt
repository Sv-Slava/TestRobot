Тест робота на BollingerBands

Тест велся на котировках BTCUSDT (1 мин), загруженных из Binance 
 и из файла SBER_170101_171231_15 (15 мин), скаченный с finam
Тест выполняется для Long и Short позиций.
Результаты предаставлены на скринах в папке "Сделки"
GitHub: https://github.com/Sv-Slava/TestRobot.git

При тестах не разобрался как исправить следующий баг: 
- иногда новая сделка открывается в противоположном направлении но на следующей свече после закрытия предыдущей сделки.

не очень понял условие: 
цена входа = нижняя линия боллинжера - отступ на открытие.
Сделал вход сделку на закрытии свечи (могу исправить при обьяснении). 